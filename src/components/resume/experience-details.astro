---
import type { Mission, Experience } from "@/lib/types/resume.types";
import BulletedList from "../ui/bulleted-list.astro";
import AwsIcon from "@/icons/resume/aws.svg";
import NestIcon from "@/icons/resume/nest.svg";
import NextIcon from "@/icons/resume/next.svg";
import NodeIcon from "@/icons/resume/node.svg";
import ReactIcon from "@/icons/resume/react.svg";
import TerraformIcon from "@/icons/resume/terraform.svg";
import WcIcon from "@/icons/resume/wc.svg";

import { format } from "date-fns";
import type { SvgComponent } from "astro/types";

interface Props extends Pick<Experience, "summary" | "highlights" | "stack"> {
  missions: Mission[];
}

const iconMap: Record<string, SvgComponent> = {
  "resume/aws": AwsIcon,
  "resume/nest": NestIcon,
  "resume/next": NextIcon,
  "resume/node": NodeIcon,
  "resume/react": ReactIcon,
  "resume/terraform": TerraformIcon,
  "resume/wc": WcIcon,
};

const { summary, highlights, missions, stack } = Astro.props;
---

<div class="flex flex-col gap-4">
  {
    Boolean(summary.length) && (
      <div>
        <p class="font-semibold text-lg mb-2">Summary</p>
        <BulletedList>
          {summary.map((summaryItem) => (
            <li class="text-muted-foreground">{summaryItem}</li>
          ))}
        </BulletedList>
      </div>
    )
  }
  {
    Boolean(missions.length) && (
      <div>
        <p class="font-semibold text-lg mb-2">Missions</p>
        <BulletedList>
          {missions.map(({ name, position, startDate, endDate }) => (
            <li>
              <span>
                {name} -
                <span class="text-muted-foreground">{`${position} (${format(startDate, "MMMM yyyy")} - ${endDate === "present" ? "Present" : format(endDate, "MMMM yyyy")})`}</span>
              </span>
            </li>
          ))}
        </BulletedList>
      </div>
    )
  }
  {
    Boolean(highlights.length) && (
      <div>
        <p class="font-semibold text-lg mb-2">Highlights</p>
        <BulletedList>
          {highlights.map((highlight) => (
            <li class="text-muted-foreground">{highlight}</li>
          ))}
        </BulletedList>
      </div>
    )
  }
  {
    Boolean(stack.length) && (
      <div>
        <p class="font-semibold text-lg mb-2">Technologies</p>
        <div class="grid grid-cols-3 md:flex md:flex-wrap gap-4">
          {stack.map(({ name: techName, src: iconFileName }) => {
            const IconComponent = iconMap[iconFileName];
            return (
              <div class="inline-flex gap-1">
                {IconComponent && <IconComponent class="size-6" />}
                <span>{techName}</span>
              </div>
            );
          })}
        </div>
      </div>
    )
  }
</div>
